{"code":"import Clock from './clock';\r\nimport { EntityManager } from './entity';\r\nimport * as PIXI from 'pixi.js';\r\nexport default class GameWorld extends EntityManager {\r\n    constructor(state) {\r\n        super();\r\n        this.tickId = (delta) => {\r\n            this.state.clock.updateTime(delta);\r\n            this.loop();\r\n        };\r\n        this.state = {\r\n            ...state,\r\n            clock: new Clock(),\r\n            levels: [],\r\n            currentLevelIndex: 0\r\n        };\r\n    }\r\n    get currentLevel() {\r\n        return this.state.levels[this.state.currentLevelIndex];\r\n    }\r\n    addLevel(level, onLoad, onFinish) {\r\n        level.onLoad = onLoad;\r\n        level.onFinish = onFinish;\r\n        this.state.levels.push(level);\r\n        return this;\r\n    }\r\n    spriteSheetPrefix({ name, url, data }) {\r\n        const callback = (resource) => {\r\n            if (resource.error) {\r\n                console.error(resource.error); // tslint:disable-line\r\n            }\r\n            else {\r\n                const texture = resource.texture.baseTexture;\r\n                const sheet = new PIXI.Spritesheet(texture, data);\r\n                sheet.parse(() => { });\r\n            }\r\n        };\r\n        return { name, url, callback };\r\n    }\r\n    preload(...resources) {\r\n        PIXI.loader.add(resources.flat().map(resource => {\r\n            if (typeof resource === 'string') {\r\n                return resource;\r\n            }\r\n            return this.spriteSheetPrefix(resource);\r\n        }));\r\n        return this;\r\n    }\r\n    preloadNetWorkResource(...resources) {\r\n        resources.forEach(resource => PIXI.loader.add(resource.url, resource.loadType));\r\n        return this;\r\n    }\r\n    loop() {\r\n        const { levels, currentLevelIndex } = this.state;\r\n        if (!levels.length) {\r\n            return false;\r\n        }\r\n        levels[currentLevelIndex].loop();\r\n    }\r\n    nextLevel() {\r\n        const lastLevel = this.state.levels[this.state.currentLevelIndex];\r\n        lastLevel.finish();\r\n        this.removeEntity(lastLevel);\r\n        const nextLevelIndex = this.state.currentLevelIndex + 1;\r\n        if (!this.state.levels[nextLevelIndex]) {\r\n            return this.finish();\r\n        }\r\n        this.state.currentLevelIndex += 1;\r\n        this.currentLevel.initLevel(this);\r\n    }\r\n    finish() {\r\n        console.log('Game Over'); // tslint:disable-line\r\n        this.app.ticker.remove(this.tickId);\r\n    }\r\n    /**\r\n     *\r\n     * @param app PIXI.Application instance\r\n     * @param callbackFn Callback function\r\n     * @example\r\n     * const app = new PIXI.Application({\r\n     *   width,\r\n     *   height,\r\n     *   backgroundColor,\r\n     *   view\r\n     * })\r\n     * new GameWorld()\r\n     *  .render(app, () => {\r\n     *     console.log('Hello world')\r\n     *   })\r\n     */\r\n    render(app, callbackFn) {\r\n        PIXI.loader.load(() => {\r\n            if (callbackFn)\r\n                callbackFn();\r\n            this.state.clock.start();\r\n            this.currentLevel.initLevel(this);\r\n            this.app = app;\r\n            this.app.stage.addChild(this.sprite);\r\n            this.app.ticker.add(this.tickId);\r\n        });\r\n        return this;\r\n    }\r\n}\r\n//# sourceMappingURL=world.js.map","references":["/Users/taugocauci/Workspace/personal/game/src/clock.ts","/Users/taugocauci/Workspace/personal/game/src/entity/index.ts","/Users/taugocauci/Workspace/personal/game/src/level.ts","/Users/taugocauci/Workspace/personal/game/node_modules/@types/pixi.js/index.d.ts"],"map":"{\"version\":3,\"file\":\"world.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/world.ts\"],\"names\":[],\"mappings\":\"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\"}"}
